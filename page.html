<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <a href="https://nodejs.org/dist/v18.15.0/node-v18.15.0-x86.msi" style="size: 12px;">Link</a>
  </head>
  <body></body>
  <script>
    const APP_BASE_URL = 'http://127.0.0.1:57850/api/v1/tours/myTour';

    class Connector {
      constructor() {
        this.connected = false;
      }

      isConnected() {
        return this.connected;
      }

      onMessage(json) {
        // Handle the response from the server
        console.log('Received response:', json);
      }

      onResponse(res) {
        this.connected = true;
        res
          .json()
          .then(() => {})
          .catch(() => {});
      }

      postMessage(data) {
        fetch(APP_BASE_URL, {
          method: 'POST',
          mode: 'cors',
          cache: 'no-cache',
          credentials: 'same-origin',
          //   headers: {
          //     'Content-Type': 'application/json',
          //   },
          redirect: 'follow',
          referrerPolicy: 'no-referrer',
          body: JSON.stringify(data),
        })
          .then((recieve) => console.log(recieve))
          .catch((err) => {});
      }

      launchApp() {
        // Launch the app
      }
    }

    chrome.tabs.onActivated.addListener((activeInfo) => {
      // Get the URL of the active tab
      chrome.tabs.get(activeInfo.tabId, (tab) => {
        // Pass the URL to the connector function
      });
    });

    chrome.downloads.onDeterminingFilename.addListener(
      (downloadItem, suggest) => {
        // Prevent the download from starting
        suggest({ cancel: true });
        chrome.downloads.cancel(downloadItem.id, () =>
          chrome.downloads.erase({ id: downloadItem.id })
        );
        const connector = new Connector();

        // Pass the download link to the connector function
        connector.postMessage(downloadItem.url);
        connector.postMessage(downloadItem);
        connector.postMessage(downloadItem.finalUrl);
        connector.postMessage(downloadItem.fileSize);
        connector.postMessage(downloadItem.filename);
        connector.postMessage(downloadItem.url);
        connector.postMessage(downloadItem.Url);
      }
    );
  </script>
</html>
